#Как выкладываются сборки

Созданы специальные пайплайны, которые умеют запускать сборку, а потом
выкладывать результат на виртуалку, включив в имя файла время сборки,
версию проекта и ветку.

Есть вариант сборки всего сразу и вариант сборки фронта отдельно.

Каждый вечер где-то около полуночи происходит автоматическая сборка 
и выкладка всего из мастера.

Для выкладки по запросу нужно действовать через BitBucket:

1. Зайти в раздел Branches
2. В строке master нажать на многоточие (справа)
3. Выбрать "Run pipeline for a branch"
4. Выбрать "custom: full deliver" для полной выкладки и "custom: frontend deliver" только для фронта
5. Подождать 5-10 минут после успешного завершения пайплайна.

##Что происходит на виртуалке

Есть скрипт, который знает, куда складываются свежие сборки.
Оно периодически запускается по крону и, увидев что-то свежее,
перекладывает его в то место, откуда удобно будет запускать.

Есть другой скрипт, который тоже запускается по крону. Он, увидев что-то новое, 
завершает приготовления к запуску, останавливает работающий сервис, переключает
символические ссылки запускает все заново. 

Фронт запускается на отдельном http-сервере. Сервер настроен так, чтобы запросы на
/api проксировались на бекендный сервер.

##Troubleshouting

Контролировать успешность процесса можно через
http://catalog.reflexia.com/deploy-status

Last - последний артефакт обнаруженный на виртуалке
Running - запущенный артефакт
Status - результат периодической проверки на наличие слушателя на соответствующем порту.

Если Status - DOWN, это значит, что соответствующий сервер просто упал и не работает.

Если - UP, это значит, что сервер слушает порт. Не факт, что он работает правильно и корректно.
Если показывает UP, но в браузере ничего не работает, надо разбираться.
Не исключено, что дело в бизнес логике.

Last и Running  почти всегда должны быть равны.
Могут быть не равны несколько минут после завершения пайплайна.
Если не равны долго, значит надо разбираться, почему новая версия не запускается.

Метки времени гринвичские. Надо это учитывать.

Если пайплайн прошел, а Last остается неактуальным, значит не работает скрипт, ответственный за прием артефактов. 
 